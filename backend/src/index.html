<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Diário de Leitura</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>Meu Diário de Leitura</h1>
    </div>
  </header>

  <main>
    <div class="container conteudo">

      <!-- FILTROS -->
      <aside class="filtros">
        <h3>Filtros</h3>

        <label for="filtro-genero">Gênero</label>
        <select id="filtro-genero">
          <option value="">Todos os gêneros</option>
          <option>Fantasia</option>
          <option>Ficção Científica</option>
          <option>Romance</option>
          <option>Drama</option>
        </select>

        <label for="filtro-nota">Nota</label>
        <select id="filtro-nota">
          <option value="">Todas as notas</option>
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>

        <button id="btn-filtro">Aplicar Filtros</button>
      </aside>

      <!-- CONTEÚDO PRINCIPAL -->
      <section class="principal">

        <section class="formulario">
          <h2>Registre sua Leitura</h2>

          <form id="form-livro">
            <div class="linha">
              <label for="titulo">Título do Livro</label>
              <input type="text" id="titulo" required>
            </div>

            <div class="linha">
              <label for="autor">Autor</label>
              <input type="text" id="autor" required>
            </div>

            <div class="linha">
              <label for="genero">Gênero</label>
              <select id="genero" required>
                <option value="">Selecione o gênero</option>
                <option>Fantasia</option>
                <option>Ficção Científica</option>
                <option>Romance</option>
                <option>Drama</option>
              </select>
            </div>

            <div class="linha">
              <label for="paginas">Total de Páginas</label>
              <input type="number" id="paginas" required>
            </div>

            <div class="linha">
              <label for="tempo">Tempo de Leitura (horas)</label>
              <input type="number" id="tempo" required>
            </div>

            <div class="linha">
              <label for="nota">Sua Nota (1–5)</label>
              <select id="nota" required>
                <option value="">Selecione</option>
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
              </select>
            </div>

            <div class="linha">
              <label for="resenha">Resenha</label>
              <textarea id="resenha" rows="3"></textarea>
            </div>

            <div class="botoes">
              <button type="reset" class="btn-cancelar">Cancelar</button>
              <button type="submit" class="btn-registrar">Registrar Leitura</button>
            </div>
          </form>
        </section>

        <section class="livros">
          <h2>Livros Registrados</h2>
          <div class="lista-livros" id="lista-livros"></div>
        </section>

      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>© 2025 Meu Diário de Leitura</p>
    </div>
  </footer>
</body>

<!-- SCRIPT JS -->
<script>
const API_URL = "http://localhost:3000";

// Carrega livros ao abrir
window.addEventListener("load", carregarLivros);

// Função para buscar livros
async function carregarLivros() {
  try {
    const resposta = await fetch(API_URL + "/livro?pagina=1&quantidade=20");
    const livros = await resposta.json();

    const lista = document.getElementById("lista-livros");
    lista.innerHTML = "";

    livros.forEach(l => {
      const div = document.createElement("div");
      div.classList.add("livro");
      div.innerHTML = `
        <div class="capa">Capa do Livro</div>
        <p><strong>${l.titulo}</strong><br>${l.autor}<br>
        <small>${l.categoria} • ${l.paginas} págs</small><br>
        <small>Nota: ${l.nota}</small></p>
      `;
      lista.appendChild(div);
    });
  } catch (error) {
    console.error("Erro ao carregar livros:", error);
  }
}

// Cadastra novo livro
document.getElementById("form-livro").addEventListener("submit", async (e) => {
  e.preventDefault();

  const dados = {
    titulo: document.getElementById("titulo").value,
    autor: document.getElementById("autor").value,
    categoria: document.getElementById("genero").value,
    paginas: document.getElementById("paginas").value,
    tempo_leitura: document.getElementById("tempo").value,
    nota: document.getElementById("nota").value,
    resenha: document.getElementById("resenha").value
  };

  try {
    const resposta = await fetch(API_URL + "/livro", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(dados)
    });

    if (resposta.ok) {
      alert("Livro registrado com sucesso!");
      e.target.reset();
      carregarLivros();
    } else {
      alert("Erro ao registrar livro.");
    }
  } catch (error) {
    console.error("Erro ao enviar dados:", error);
  }
});
</script>
</html>
